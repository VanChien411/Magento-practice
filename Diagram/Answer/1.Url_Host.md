ƒê·ªÉ ph√¢n t√≠ch chi ti·∫øt URL d·∫°ng `hostname/a/b_c_d/e` trong b·ªëi c·∫£nh Magento 2, ch√∫ng ta c·∫ßn xem x√©t c√°ch Magento x·ª≠ l√Ω URL, c·∫•u tr√∫c ƒë·ªãnh tuy·∫øn (routing), v√† c√°c th√†nh ph·∫ßn li√™n quan. V√¨ b·∫°n ƒëang h·ªèi v·ªÅ Magento 2 (d·ª±a tr√™n c√°c c√¢u h·ªèi tr∆∞·ªõc v·ªÅ th∆∞ m·ª•c `view` v√† `event`), t√¥i s·∫Ω gi·∫£ ƒë·ªãnh r·∫±ng URL n√†y li√™n quan ƒë·∫øn m·ªôt website Magento 2 v√† ph√¢n t√≠ch n√≥ trong ng·ªØ c·∫£nh ƒë√≥. D∆∞·ªõi ƒë√¢y l√† c√¢u tr·∫£ l·ªùi chi ti·∫øt, bao g·ªìm c√°c th√†nh ph·∫ßn c·ªßa URL, c√°ch Magento x·ª≠ l√Ω, v√† c√°c c√¢u h·ªèi li√™n quan.

---
Magento 2 y√™u c·∫ßu m·ªói action = 1 class ri√™ng bi·ªát, theo chu·∫©n PSR v√† framework MVC c·ªßa n√≥.
- http://localhost.m246/vi/helloworld/index/collection?sku=abc123&name=test&price_from=100

üëâ M·ªói action l√† 1 file PHP ri√™ng n·∫±m trong Controller\<Router>\<ActionName>.php.



### 1. Ph√¢n t√≠ch URL: `hostname/a/b_c_d/e`

URL `hostname/a/b_c_d/e` c√≥ th·ªÉ ƒë∆∞·ª£c chia th√†nh c√°c th√†nh ph·∫ßn sau:

- **hostname**: ƒê√¢y l√† t√™n mi·ªÅn ho·∫∑c ƒë·ªãa ch·ªâ m√°y ch·ªß c·ªßa website (v√≠ d·ª•: `example.com`, `www.mysite.com`, ho·∫∑c `localhost` trong m√¥i tr∆∞·ªùng ph√°t tri·ªÉn). Trong Magento 2, hostname th∆∞·ªùng ƒë∆∞·ª£c c·∫•u h√¨nh trong ph·∫ßn **Store Configuration** (C·∫•u h√¨nh c·ª≠a h√†ng) ƒë·ªÉ x√°c ƒë·ªãnh base URL c·ªßa website.
- **/a**: Ph·∫ßn ƒë·∫ßu ti√™n sau hostname, th∆∞·ªùng ƒë·∫°i di·ªán cho m·ªôt **frontName** ho·∫∑c m·ªôt **URL key** trong Magento 2.
- **/b_c_d**: Ph·∫ßn th·ª© hai, c√≥ th·ªÉ l√† m·ªôt **action controller** ho·∫∑c m·ªôt **URL key** c·ªßa m·ªôt trang c·ª• th·ªÉ (v√≠ d·ª•: danh m·ª•c, s·∫£n ph·∫©m, ho·∫∑c CMS page).
- **/e**: Ph·∫ßn cu·ªëi, c√≥ th·ªÉ l√† m·ªôt **action method**, m·ªôt **tham s·ªë**, ho·∫∑c m·ªôt **URL key** kh√°c.

**C·∫•u tr√∫c t·ªïng qu√°t** c·ªßa URL trong Magento 2 th∆∞·ªùng tu√¢n theo d·∫°ng:
```
hostname/[frontName]/[controller]/[action]
```
Ho·∫∑c, n·∫øu l√† URL th√¢n thi·ªán (SEO-friendly URL), n√≥ c√≥ th·ªÉ l√†:
```
hostname/[URL-key]/[sub-URL-key]/[param]
```

D·ª±a tr√™n c·∫•u tr√∫c n√†y, t√¥i s·∫Ω ph√¢n t√≠ch t·ª´ng kh·∫£ nƒÉng c·ªßa URL `hostname/a/b_c_d/e`.

---

### 2. C√°ch Magento 2 x·ª≠ l√Ω URL
Magento 2 s·ª≠ d·ª•ng h·ªá th·ªëng **routing** ƒë·ªÉ √°nh x·∫° URL ƒë·∫øn c√°c **controller**, **action**, ho·∫∑c c√°c th·ª±c th·ªÉ nh∆∞ s·∫£n ph·∫©m, danh m·ª•c, ho·∫∑c trang CMS. D∆∞·ªõi ƒë√¢y l√† c√°ch Magento x·ª≠ l√Ω URL nh∆∞ `hostname/a/b_c_d/e`:

#### 2.1. Tr∆∞·ªùng h·ª£p 1: URL li√™n quan ƒë·∫øn Module (Front Controller)
N·∫øu URL n√†y tr·ªè ƒë·∫øn m·ªôt module t√πy ch·ªânh ho·∫∑c module core c·ªßa Magento, c·∫•u tr√∫c s·∫Ω l√†:

- **frontName (`a`)**: ƒê√¢y l√† t√™n c·ªßa **frontName** ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong file `routes.xml` c·ªßa module. FrontName l√† ph·∫ßn ƒë·∫ßu ti√™n c·ªßa URL, gi√∫p Magento x√°c ƒë·ªãnh module n√†o s·∫Ω x·ª≠ l√Ω y√™u c·∫ßu.
  - V√≠ d·ª•: Trong module `Magento_Customer`, frontName l√† `customer` (d·∫´n ƒë·∫øn URL nh∆∞ `example.com/customer/account/login`).
  - Trong tr∆∞·ªùng h·ª£p n√†y, `a` c√≥ th·ªÉ l√† frontName c·ªßa m·ªôt module, v√≠ d·ª•: `catalog`, `checkout`, ho·∫∑c m·ªôt module t√πy ch·ªânh.

- **controller (`b_c_d`)**: ƒê√¢y l√† t√™n c·ªßa controller trong module. Trong Magento 2, t√™n controller th∆∞·ªùng ƒë∆∞·ª£c vi·∫øt theo ki·ªÉu **PascalCase** trong code (v√≠ d·ª•: `B_C_D`), nh∆∞ng trong URL, n√≥ ƒë∆∞·ª£c chuy·ªÉn th√†nh d·∫°ng **kebab-case** ho·∫∑c **snake_case** (v√≠ d·ª•: `b_c_d`).
  - V√≠ d·ª•: Controller `AccountController` trong module `Magento_Customer` s·∫Ω √°nh x·∫° ƒë·∫øn `/account` trong URL.

- **action (`e`)**: ƒê√¢y l√† ph∆∞∆°ng th·ª©c (action) trong controller s·∫Ω ƒë∆∞·ª£c g·ªçi. Action th∆∞·ªùng l√† m·ªôt ph∆∞∆°ng th·ª©c trong class controller, v√≠ d·ª•: `index`, `view`, `edit`.
  - V√≠ d·ª•: URL `example.com/customer/account/login` g·ªçi ph∆∞∆°ng th·ª©c `login` trong `AccountController`.

**V√≠ d·ª• c·ª• th·ªÉ**:
N·∫øu b·∫°n c√≥ m·ªôt module t√πy ch·ªânh v·ªõi c·∫•u tr√∫c:
```
app/code/Vendor/Module/
‚îú‚îÄ‚îÄ Controller/
‚îÇ   ‚îî‚îÄ‚îÄ BCD/
‚îÇ       ‚îî‚îÄ‚îÄ E.php
‚îú‚îÄ‚îÄ etc/
‚îÇ   ‚îî‚îÄ‚îÄ frontend/
‚îÇ       ‚îî‚îÄ‚îÄ routes.xml
```
V√† file `routes.xml` nh∆∞ sau:
```xml
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:App/etc/routes.xsd">
    <router id="standard">
        <route id="module" frontName="a">
            <module name="Vendor_Module" />
        </route>
    </router>
</config>
```
Th√¨ URL `hostname/a/b_c_d/e` s·∫Ω √°nh x·∫° ƒë·∫øn:
- Module: `Vendor_Module`
- Controller: `Vendor\Module\Controller\BCD`
- Action: Ph∆∞∆°ng th·ª©c `e()` trong class `E`.

#### 2.2. Tr∆∞·ªùng h·ª£p 2: URL th√¢n thi·ªán (SEO-friendly URL)
N·∫øu URL kh√¥ng ph·∫£i l√† m·ªôt front controller m√† l√† m·ªôt URL th√¢n thi·ªán (th∆∞·ªùng d√πng cho danh m·ª•c, s·∫£n ph·∫©m, ho·∫∑c trang CMS), c√°c th√†nh ph·∫ßn s·∫Ω ƒë∆∞·ª£c √°nh x·∫° nh∆∞ sau:

- **/a**: C√≥ th·ªÉ l√† **URL key** c·ªßa m·ªôt danh m·ª•c c·∫•p cao (top-level category).
- **/b_c_d**: C√≥ th·ªÉ l√† **URL key** c·ªßa m·ªôt danh m·ª•c con (sub-category) ho·∫∑c s·∫£n ph·∫©m.
- **/e**: C√≥ th·ªÉ l√† **URL key** c·ªßa s·∫£n ph·∫©m ho·∫∑c m·ªôt tham s·ªë b·ªï sung (v√≠ d·ª•: `id` c·ªßa s·∫£n ph·∫©m).

**V√≠ d·ª•**:
- URL: `example.com/men/shirts/casual-shirt` c√≥ th·ªÉ √°nh x·∫° ƒë·∫øn:
  - `men`: Danh m·ª•c c·∫•p cao.
  - `shirts`: Danh m·ª•c con.
  - `casual-shirt`: S·∫£n ph·∫©m c·ª• th·ªÉ.
- Magento s·ª≠ d·ª•ng **URL Rewrite** (trong b·∫£ng `url_rewrite`) ƒë·ªÉ √°nh x·∫° c√°c URL th√¢n thi·ªán n√†y ƒë·∫øn c√°c route n·ªôi b·ªô, v√≠ d·ª•:
  - `men/shirts/casual-shirt` ƒë∆∞·ª£c rewrite th√†nh `catalog/product/view/id/123`.

**Ki·ªÉm tra trong database**:
- B·∫£ng `url_rewrite` ch·ª©a c√°c √°nh x·∫° t·ª´ URL th√¢n thi·ªán (`request_path`) ƒë·∫øn URL n·ªôi b·ªô (`target_path`).
- V√≠ d·ª•:
  ```sql
  SELECT * FROM url_rewrite WHERE request_path = 'a/b_c_d/e';
  ```
  K·∫øt qu·∫£ c√≥ th·ªÉ cho th·∫•y `target_path` l√† `catalog/product/view/id/123` ho·∫∑c `catalog/category/view/id/456`.

#### 2.3. Tr∆∞·ªùng h·ª£p 3: Trang CMS ho·∫∑c URL tƒ©nh
N·∫øu URL tr·ªè ƒë·∫øn m·ªôt trang CMS ho·∫∑c t√†i nguy√™n tƒ©nh:
- **/a/b_c_d/e** c√≥ th·ªÉ l√† **identifier** c·ªßa m·ªôt trang CMS ho·∫∑c m·ªôt ƒë∆∞·ªùng d·∫´n t√πy ch·ªânh ƒë∆∞·ª£c c·∫•u h√¨nh trong **URL Rewrite**.
- V√≠ d·ª•: Trang CMS v·ªõi identifier `about-us/team/contact` c√≥ th·ªÉ ƒë∆∞·ª£c truy c·∫≠p qua URL `example.com/about-us/team/contact`.

#### 2.4. Tr∆∞·ªùng h·ª£p 4: Tham s·ªë ho·∫∑c Query String
N·∫øu `/e` l√† m·ªôt tham s·ªë, URL c√≥ th·ªÉ ƒë∆∞·ª£c x·ª≠ l√Ω nh∆∞ m·ªôt query string n·ªôi b·ªô. V√≠ d·ª•:
- `example.com/catalog/product/view/id/123` c√≥ th·ªÉ ƒë∆∞·ª£c rewrite th√†nh `example.com/a/b_c_d/e`, trong ƒë√≥ `e` l√† gi√° tr·ªã c·ªßa m·ªôt tham s·ªë (nh∆∞ `id` ho·∫∑c `sku`).

---

### 3. C√°c th√†nh ph·∫ßn li√™n quan trong Magento 2
ƒê·ªÉ hi·ªÉu r√µ h∆°n c√°ch Magento x·ª≠ l√Ω URL `hostname/a/b_c_d/e`, d∆∞·ªõi ƒë√¢y l√† c√°c th√†nh ph·∫ßn li√™n quan:

- **routes.xml**: File c·∫•u h√¨nh ƒë·ªãnh nghƒ©a frontName v√† module. N·∫±m trong `etc/frontend/routes.xml` (cho frontend) ho·∫∑c `etc/adminhtml/routes.xml` (cho backend).
- **Controller**: C√°c class controller n·∫±m trong th∆∞ m·ª•c `Controller` c·ªßa module, x·ª≠ l√Ω logic cho URL.
- **URL Rewrite**: Qu·∫£n l√Ω √°nh x·∫° gi·ªØa URL th√¢n thi·ªán v√† URL n·ªôi b·ªô. C√≥ th·ªÉ ƒë∆∞·ª£c c·∫•u h√¨nh trong:
  - Database (b·∫£ng `url_rewrite`).
  - Admin panel: **Marketing > SEO & Search > URL Rewrites**.
- **Request Object**: ƒê·ªëi t∆∞·ª£ng `\Magento\Framework\App\Request\Http` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l·∫•y th√¥ng tin t·ª´ URL:
  ```php
  $request = $this->_request;
  $frontName = $request->getModuleName(); // L·∫•y 'a'
  $controller = $request->getControllerName(); // L·∫•y 'b_c_d'
  $action = $request->getActionName(); // L·∫•y 'e'
  ```

- **Router**: Magento s·ª≠ d·ª•ng c√°c router ƒë·ªÉ x·ª≠ l√Ω URL:
  - `\Magento\Framework\App\Router\Standard`: X·ª≠ l√Ω URL c·ªßa module.
  - `\Magento\UrlRewrite\Controller\Router`: X·ª≠ l√Ω URL rewrite.
  - `\Magento\Cms\Controller\Router`: X·ª≠ l√Ω trang CMS.

---

### 4. C√°c c√¢u h·ªèi t∆∞∆°ng t·ª± ho·∫∑c li√™n quan
D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë c√¢u h·ªèi c√≥ s·ª± t∆∞∆°ng ƒë·ªìng ho·∫∑c li√™n quan ƒë·∫øn ch·ªß ƒë·ªÅ v·ªÅ URL trong Magento 2:

1. **L√†m th·∫ø n√†o ƒë·ªÉ t·∫°o m·ªôt URL t√πy ch·ªânh trong Magento 2?**
   - **Tr·∫£ l·ªùi**:
     - T·∫°o module v·ªõi `routes.xml` ƒë·ªÉ ƒë·ªãnh nghƒ©a frontName.
     - Th√™m controller v√† action ƒë·ªÉ x·ª≠ l√Ω URL.
     - S·ª≠ d·ª•ng **URL Rewrite** trong admin ho·∫∑c database ƒë·ªÉ √°nh x·∫° URL th√¢n thi·ªán.

2. **S·ª± kh√°c bi·ªát gi·ªØa frontName v√† URL key trong Magento 2 l√† g√¨?**
   - **Tr·∫£ l·ªùi**:
     - **frontName**: L√† ph·∫ßn ƒë·∫ßu ti√™n c·ªßa URL, ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong `routes.xml`, √°nh x·∫° ƒë·∫øn m·ªôt module.
     - **URL key**: L√† ph·∫ßn th√¢n thi·ªán v·ªõi SEO, ƒë∆∞·ª£c s·ª≠ d·ª•ng cho danh m·ª•c, s·∫£n ph·∫©m, ho·∫∑c trang CMS, l∆∞u trong b·∫£ng `url_rewrite`.

3. **L√†m th·∫ø n√†o ƒë·ªÉ debug m·ªôt URL kh√¥ng ho·∫°t ƒë·ªông trong Magento 2?**
   - **Tr·∫£ l·ªùi**:
     - Ki·ªÉm tra b·∫£ng `url_rewrite` ƒë·ªÉ xem √°nh x·∫° c·ªßa URL.
     - Ki·ªÉm tra `routes.xml` c·ªßa module li√™n quan.
     - S·ª≠ d·ª•ng log ho·∫∑c Xdebug ƒë·ªÉ ki·ªÉm tra lu·ªìng x·ª≠ l√Ω c·ªßa request:
       ```php
       $writer = new \Zend\Log\Writer\Stream(BP . '/var/log/url.log');
       $logger = new \Zend\Log\Logger();
       $logger->addWriter($writer);
       $logger->info($this->_request->getPathInfo());
       ```

4. **L√†m th·∫ø n√†o ƒë·ªÉ th√™m tham s·ªë v√†o URL trong Magento 2?**
   - **Tr·∫£ l·ªùi**:
     - Th√™m tham s·ªë tr·ª±c ti·∫øp v√†o URL: `example.com/a/b_c_d/e?param=value`.
     - S·ª≠ d·ª•ng ƒë·ªëi t∆∞·ª£ng `\Magento\Framework\UrlInterface` ƒë·ªÉ t·∫°o URL v·ªõi tham s·ªë:
       ```php
       $url = $this->_url->getUrl('a/b_c_d/e', ['param' => 'value']);
       ```

5. **T·∫°i sao URL c·ªßa t√¥i b·ªã chuy·ªÉn h∆∞·ªõng ho·∫∑c b√°o 404?**
   - **Tr·∫£ l·ªùi**:
     - Ki·ªÉm tra xem frontName, controller, ho·∫∑c action c√≥ t·ªìn t·∫°i kh√¥ng.
     - Ki·ªÉm tra b·∫£ng `url_rewrite` ƒë·ªÉ ƒë·∫£m b·∫£o URL ƒë∆∞·ª£c √°nh x·∫° ƒë√∫ng.
     - X√≥a cache: `bin/magento cache:flush`.
     - Ki·ªÉm tra c·∫•u h√¨nh base URL trong **Stores > Configuration > General > Web**.

---

### 5. M·ªôt s·ªë l∆∞u √Ω khi l√†m vi·ªác v·ªõi URL trong Magento 2
- **SEO**: ƒê·∫£m b·∫£o b·∫≠t **URL Rewrite** trong **Stores > Configuration > General > Web > Search Engine Optimization** ƒë·ªÉ s·ª≠ d·ª•ng URL th√¢n thi·ªán.
- **Cache**: C√°c thay ƒë·ªïi li√™n quan ƒë·∫øn URL (nh∆∞ th√™m rewrite) c√≥ th·ªÉ y√™u c·∫ßu x√≥a cache ho·∫∑c reindex: `bin/magento indexer:reindex`.
- **Base URL**: ƒê·∫£m b·∫£o hostname ƒë∆∞·ª£c c·∫•u h√¨nh ƒë√∫ng trong **Stores > Configuration > General > Web**.
- **Debugging**: S·ª≠ d·ª•ng c√°c c√¥ng c·ª• nh∆∞ Xdebug ho·∫∑c log ƒë·ªÉ ki·ªÉm tra lu·ªìng x·ª≠ l√Ω URL:
  ```php
  $logger->info($this->_request->getModuleName() . '/' . $this->_request->getControllerName() . '/' . $this->_request->getActionName());
  ```

---

### 6. V√≠ d·ª• minh h·ªça
Gi·∫£ s·ª≠ b·∫°n mu·ªën t·∫°o m·ªôt URL t√πy ch·ªânh `example.com/blog/post/view` trong module `Vendor_Blog`:

**File routes.xml**: `app/code/Vendor/Blog/etc/frontend/routes.xml`
```xml
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:App/etc/routes.xsd">
    <router id="standard">
        <route id="blog" frontName="blog">
            <module name="Vendor_Blog" />
        </route>
    </router>
</config>
```

**Controller**: `app/code/Vendor/Blog/Controller/Post/View.php`
```php
namespace Vendor\Blog\Controller\Post;

use Magento\Framework\App\Action\Action;
use Magento\Framework\App\Action\Context;

class View extends Action
{
    public function execute()
    {
        // Logic ƒë·ªÉ hi·ªÉn th·ªã b√†i vi·∫øt
        $this->_view->loadLayout();
        $this->_view->renderLayout();
    }
}
```

**K·∫øt qu·∫£**: URL `example.com/blog/post/view` s·∫Ω g·ªçi ph∆∞∆°ng th·ª©c `execute()` trong `Vendor\Blog\Controller\Post\View`.

---

### 7. K·∫øt lu·∫≠n
URL `hostname/a/b_c_d/e` trong Magento 2 c√≥ th·ªÉ ƒë∆∞·ª£c hi·ªÉu nh∆∞ sau:
- **Tr∆∞·ªùng h·ª£p module**: `a` l√† frontName, `b_c_d` l√† controller, `e` l√† action.
- **Tr∆∞·ªùng h·ª£p SEO-friendly**: `a/b_c_d/e` l√† c√°c URL key c·ªßa danh m·ª•c, s·∫£n ph·∫©m, ho·∫∑c trang CMS, ƒë∆∞·ª£c √°nh x·∫° qua b·∫£ng `url_rewrite`.
- **Tr∆∞·ªùng h·ª£p kh√°c**: `e` c√≥ th·ªÉ l√† tham s·ªë ho·∫∑c m·ªôt ph·∫ßn c·ªßa URL tƒ©nh.

ƒê·ªÉ x√°c ƒë·ªãnh ch√≠nh x√°c, b·∫°n c·∫ßn:
- Ki·ªÉm tra `routes.xml` c·ªßa c√°c module.
- Tra c·ª©u b·∫£ng `url_rewrite` trong database.
- Debug request object ƒë·ªÉ xem module, controller, v√† action ƒë∆∞·ª£c g·ªçi.

N·∫øu b·∫°n c√≥ th√™m th√¥ng tin v·ªÅ URL (v√≠ d·ª•: module c·ª• th·ªÉ, lo·∫°i trang), ho·∫∑c c·∫ßn gi·∫£i th√≠ch chi ti·∫øt h∆°n v·ªÅ m·ªôt kh√≠a c·∫°nh n√†o ƒë√≥, h√£y cho t√¥i bi·∫øt!